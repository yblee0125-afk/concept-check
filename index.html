<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ConceptCheck AI — 개념 설명</title>
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <div class="logo"></div>
      <div>
        <h1>ConceptCheck AI</h1>
        <div class="sub">개념 설명 페이지 · 기준 정의 작성 후 문제 풀이로 이동</div>
      </div>
    </div>
    <div class="controls">
      <button class="btn primary" id="btnGo">문제 풀이로 이동 →</button>
    </div>
  </header>

  <div class="grid">
    <!-- Left (1.2fr) -->
    <section class="card">
      <div class="hd">
        <div>
          <p class="title">개념 선택 · 기준 정의</p>
          <div class="desc">교과/개념을 고르고, 기준 설명(교과서/노트)을 정리하세요.</div>
        </div>
        <div class="split">
          <button class="btn" id="btnExample">예시 채우기</button>
        </div>
      </div>

      <div class="bd">
        <div class="row">
          <label>교과/영역</label>
          <div class="chips" id="subjectChips"></div>
        </div>

        <div class="twocol">
          <div class="row">
            <label>개념(Concept)</label>
            <select id="conceptSelect"></select>
          </div>
          <div class="row">
            <label>난이도(학년/수준)</label>
            <select id="level">
              <option value="elementary">초등</option>
              <option value="middle" selected>중등</option>
              <option value="high">고등</option>
            </select>
          </div>
        </div>

        <div class="row">
          <label>정확한 개념 설명(기준)</label>
          <textarea id="gold"></textarea>
          <div class="small muted">팁: 정의 + 핵심 요소 + 조건/예시 형태가 좋아요.</div>
        </div>
      </div>
    </section>

    <!-- Right (0.8fr) -->
    <aside class="card">
      <div class="hd">
        <div>
          <p class="title">다음 단계 안내</p>
          <div class="desc">작성한 기준 정의가 문제 풀이 페이지로 전달됩니다.</div>
        </div>
      </div>
      <div class="bd">
        <div class="item">
          <div style="font-size:13px; font-weight:700; margin-bottom:6px;">저장/이동 방식</div>
          <div class="small muted" style="line-height:1.6;">
            - 선택한 교과/개념/난이도/기준 정의는 브라우저 localStorage에 저장<br/>
            - 문제 풀이 페이지에서 자동 불러오기<br/>
            - GitHub Pages에서도 정상 동작
          </div>
        </div>

        <div class="hr"></div>

        <div class="item">
          <div style="font-size:13px; font-weight:700; margin-bottom:6px;">체크리스트</div>
          <div class="small muted" style="line-height:1.6;">
            1) 기준 정의에 핵심 키워드(재료/조건/결과)가 포함되어 있나요?<br/>
            2) 너무 짧지 않나요? (1~2문장 이상 권장)
          </div>
        </div>

        <div class="hr"></div>

        <button class="btn primary" style="width:100%; justify-content:center;" id="btnGo2">
          문제 풀이로 이동 →
        </button>
      </div>
    </aside>
  </div>
</div>

<script type="module">
  import { subjects, conceptsOf, getConcept, saveState, loadState } from "./app.js";

  const $ = (id)=>document.getElementById(id);
  let currentSubject = subjects()[0];

  function setSubject(subject){
    currentSubject = subject;
    document.querySelectorAll(".chip[data-subject]").forEach(ch=>{
      ch.classList.toggle("active", ch.getAttribute("data-subject")===subject);
    });
    const concepts = conceptsOf(subject);
    $("conceptSelect").innerHTML = concepts.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
    if(concepts[0]){
      $("gold").value = concepts[0].gold;
    }
    saveCurrent();
  }

  function initSubjects(){
    const root = $("subjectChips");
    root.innerHTML = "";
    subjects().forEach((sub, i)=>{
      const chip = document.createElement("div");
      chip.className = "chip" + (i===0 ? " active":"");
      chip.textContent = sub;
      chip.setAttribute("data-subject", sub);
      chip.setAttribute("data-subject", sub);
      chip.addEventListener("click", ()=> setSubject(sub));
      root.appendChild(chip);
    });
  }

  function saveCurrent(){
    const cid = $("conceptSelect").value;
    const c = getConcept(currentSubject, cid);
    saveState({
      subject: currentSubject,
      concept_id: cid,
      concept: c ? c.name : "",
      level: $("level").value,
      gold_definition: $("gold").value.trim()
    });
  }

  $("conceptSelect").addEventListener("change", ()=>{
    const c = getConcept(currentSubject, $("conceptSelect").value);
    if(c) $("gold").value = c.gold;
    saveCurrent();
  });
  $("level").addEventListener("change", saveCurrent);
  $("gold").addEventListener("input", saveCurrent);

  $("btnExample").addEventListener("click", ()=>{
    const c = getConcept(currentSubject, $("conceptSelect").value);
    if(c) $("gold").value = c.gold;
    saveCurrent();
  });

  function goPractice(){
    saveCurrent();
    location.href = "./practice.html";
  }
  $("btnGo").addEventListener("click", goPractice);
  $("btnGo2").addEventListener("click", goPractice);

  // init (state 복원)
  initSubjects();
  const st = loadState();
  if(st && st.subject){
    currentSubject = st.subject;
    // chips active 적용
    document.querySelectorAll(".chip[data-subject]").forEach(ch=>{
      ch.classList.toggle("active", ch.getAttribute("data-subject")===currentSubject);
    });
    $("level").value = st.level || "middle";
    const concepts = conceptsOf(currentSubject);
    $("conceptSelect").innerHTML = concepts.map(c=>`<option value="${c.id}">${c.name}</option>`).join("");
    $("conceptSelect").value = st.concept_id || concepts[0]?.id || "";
    $("gold").value = st.gold_definition || getConcept(currentSubject, $("conceptSelect").value)?.gold || "";
  }else{
    setSubject(currentSubject);
  }
</script>
</body>
</html>
